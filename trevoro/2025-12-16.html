<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IEC Delivery Route - Trevor O - 12/16/2025</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 10px; }
        .login-container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); max-width: 400px; width: 100%; margin: 50px auto; }
        .logo { text-align: center; margin-bottom: 25px; }
        .logo h1 { color: #2d3748; font-size: 22px; margin-bottom: 8px; }
        .logo .driver-name { color: #667eea; font-size: 18px; font-weight: 600; margin-bottom: 5px; }
        .logo p { color: #718096; font-size: 13px; }
        .form-group { margin-bottom: 18px; }
        label { display: block; color: #4a5568; font-weight: 600; margin-bottom: 8px; font-size: 14px; }
        input[type="password"] { width: 100%; padding: 12px 15px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 16px; transition: border-color 0.3s; }
        input[type="password"]:focus { outline: none; border-color: #667eea; }
        .btn-login { width: 100%; padding: 14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: transform 0.2s; }
        .btn-login:active { transform: scale(0.98); }
        .error-message { background: #fed7d7; color: #c53030; padding: 12px; border-radius: 8px; margin-top: 15px; display: none; font-size: 14px; text-align: center; }
        .error-message.show { display: block; }
        #route-content { display: none; background: white; border-radius: 12px; max-width: 800px; margin: 0 auto; overflow: hidden; }
        #route-content.show { display: block; }
        .route-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; text-align: center; }
        .route-header h2 { font-size: 24px; margin-bottom: 5px; }
        .route-header .date { font-size: 14px; opacity: 0.9; }
        .route-info { padding: 20px; background: #f7fafc; border-bottom: 2px solid #e2e8f0; }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .info-item { background: white; padding: 12px; border-radius: 8px; border-left: 4px solid #667eea; }
        .info-label { font-size: 12px; color: #718096; text-transform: uppercase; font-weight: 600; margin-bottom: 4px; }
        .info-value { font-size: 16px; color: #2d3748; font-weight: 600; }
        .stops-container { padding: 20px; }
        .stop-card { background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .stop-header { display: flex; align-items: center; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 2px solid #f7fafc; }
        .stop-number { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 20px; flex-shrink: 0; }
        .customer-info { flex: 1; margin-left: 15px; }
        .customer-name { font-size: 18px; font-weight: 700; color: #2d3748; margin-bottom: 3px; }
        .ship-to-name { font-size: 14px; color: #718096; font-weight: 500; }
        .stop-address { padding: 10px 15px; background: #f7fafc; border-radius: 6px; margin-bottom: 12px; font-size: 14px; color: #4a5568; border-left: 4px solid #667eea; }
        .btn-toggle-orders { width: 100%; padding: 14px; background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%); color: white; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; text-align: left; margin-bottom: 10px; }
        .btn-toggle-orders:active { transform: scale(0.98); }
        .order-details-container { background: #f7fafc; border: 2px solid #e2e8f0; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .order-group { background: white; border-radius: 6px; padding: 12px; margin-bottom: 12px; border-left: 4px solid #667eea; }
        .order-group:last-child { margin-bottom: 0; }
        .order-header { font-size: 15px; color: #2d3748; margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid #e2e8f0; }
        .order-items { padding-left: 10px; }
        .item-row { padding: 6px 0; font-size: 14px; display: flex; align-items: baseline; gap: 8px; }
        .item-number { font-weight: 600; color: #4a5568; min-width: 120px; }
        .item-desc { color: #718096; flex: 1; }
        .item-qty { color: #2d3748; font-weight: 600; margin-left: auto; white-space: nowrap; }
        .item-notes { padding: 8px; background: #fef3c7; border-left: 3px solid #f59e0b; border-radius: 4px; margin-top: 6px; font-size: 13px; color: #92400e; }
        .order-summary { background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); color: white; padding: 12px; border-radius: 6px; margin-top: 15px; text-align: center; font-size: 14px; font-weight: 600; }
        .review-status { background: #fef3c7; border-left: 4px solid #f59e0b; padding: 12px; border-radius: 6px; margin-bottom: 15px; font-size: 14px; color: #92400e; font-weight: 600; text-align: center; }
        .signature-section { margin-top: 15px; padding-top: 15px; border-top: 2px solid #f7fafc; }
        .signature-label { font-weight: 600; color: #2f855a; margin-bottom: 10px; font-size: 15px; }
        .signature-canvas { border: 2px solid #e2e8f0; border-radius: 8px; touch-action: none; cursor: crosshair; background: white; width: 100%; height: 150px; }
        .signature-buttons { display: flex; gap: 10px; margin-top: 10px; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 6px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .btn-clear { background: #fed7d7; color: #c53030; }
        .btn-clear:active { background: #fc8181; }
        .btn-save { background: #c6f6d5; color: #2f855a; }
        .btn-save:active { background: #9ae6b4; }
        .btn-save:disabled { background: #e2e8f0; color: #a0aec0; cursor: not-allowed; }
        .signature-status { margin-top: 10px; padding: 10px; border-radius: 6px; text-align: center; font-size: 13px; font-weight: 600; display: none; }
        .signature-status.saved { background: #c6f6d5; color: #2f855a; display: block; }
        .signature-thumbnail { margin-top: 10px; border: 2px solid #48bb78; border-radius: 6px; max-width: 250px; display: none; }
        .signature-thumbnail.show { display: block; }
        .complete-route-container { padding: 20px; background: #f7fafc; border-top: 2px solid #e2e8f0; }
        .btn-complete { width: 100%; padding: 16px; background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .btn-complete:active { transform: scale(0.98); }
        .btn-complete:disabled { background: #e2e8f0; color: #a0aec0; cursor: not-allowed; }
        .completion-status { text-align: center; padding: 20px; background: #c6f6d5; border-radius: 8px; margin-top: 15px; display: none; }
        .completion-status.show { display: block; }
        .completion-status h3 { color: #2f855a; margin-bottom: 10px; font-size: 20px; }
        .btn-export { width: 100%; padding: 16px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: 600; cursor: pointer; transition: all 0.2s; margin-top: 20px; }
        .btn-export:active { transform: scale(0.98); }
        .btn-export:disabled { background: #e2e8f0; color: #a0aec0; cursor: not-allowed; }
        .export-status { margin-top: 15px; padding: 12px; border-radius: 6px; text-align: center; font-size: 14px; font-weight: 600; display: none; }
        .export-status.success { background: #c6f6d5; color: #2f855a; display: block; }
        .export-status.error { background: #fed7d7; color: #c53030; display: block; }
    </style>

    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>

    <!-- Login Screen -->
    <div id="login-container" class="login-container">
        <div class="logo">
            <h1>IEC Supply LLC</h1>
            <div class="driver-name">Trevor O - Delivery Route</div>
            <p>Enter your password to access route sheet</p>
        </div>
        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" id="password" placeholder="Enter your password" autocomplete="off" required>
        </div>
        <button type="button" class="btn-login" onclick="login()">Access Route Sheet</button>
        <div id="error-message" class="error-message">Incorrect password. Please try again.</div>
    </div>

    <!-- Route Content -->
    <div id="route-content">
        <div class="route-header">
            <h2>Trevor O - Delivery Route</h2>
            <div class="date">December 16, 2025</div>
        </div>

        <div class="route-info">
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">Driver/Rep</div>
                    <div class="info-value" id="info-driver"></div>
                </div>
                <div class="info-item">
                    <div class="info-label">Total Stops</div>
                    <div class="info-value" id="info-stops"></div>
                </div>
                <div class="info-item">
                    <div class="info-label">Date</div>
                    <div class="info-value" id="info-date"></div>
                </div>
                <div class="info-item">
                    <div class="info-label">Route Day</div>
                    <div class="info-value">Tuesday</div>
                </div>
            </div>
        </div>

        <div class="stops-container" id="stops-container"></div>

        <div class="complete-route-container">
            <button id="btn-complete-route" class="btn-complete" onclick="completeRoute()">Complete Route</button>
            <div id="completion-status" class="completion-status">
                <h3>Route Completed!</h3>
                <p>All stops have been signed. Thank you, Trevor O!</p>
                <button id="btn-export-signatures" class="btn-export" onclick="exportSignatures()">Export to Google Drive</button>
                <div id="export-status" class="export-status"></div>
            </div>
        </div>

    <script>
        const CORRECT_PASSWORD = "Trevoro2025!";
        const DRIVER_NAME = "Trevor O";
        const SESSION_KEY = 'iec-trevoro-authenticated';

        const MANIFEST_ID = 33;

        const routeData = {
            driver: DRIVER_NAME,
            date: new Date().toLocaleDateString(),
            stops: [
                {
                    stopNumber: 1,
                    customerName: "JMT Electrical Mfg. LLC",
                    shipToName: "Primary Location",
                    address: "3441 W Whitton Ave, Phoenix , AZ 85017",
                    boxCount: 0,
                    palletCount: 0,
                    orders: [
                        {
                            orderNumber: "1204802",
                            ticketNumber: "4584747",
                            poNumber: "PO-2024-06215",
                            deliveryNotes: "",
                            items: [
                                {
                                    item: "AFLT44",
                                    description: "",
                                    qty: 2,
                                    notes: ""
                                }
                            ]
                        }
                    ],
                    totalOrders: 1,
                    totalParts: 1,
                    totalQty: 2
                },
                {
                    stopNumber: 2,
                    customerName: "JVI dba Varitec Solutions",
                    shipToName: "JVI - Shipping Address",
                    address: "2851 W. Kathleen Road, Phoenix, AZ 85053",
                    boxCount: 0,
                    palletCount: 0,
                    orders: [
                        {
                            orderNumber: "1203283",
                            ticketNumber: "4584490",
                            poNumber: "PO-2024-06215",
                            deliveryNotes: "Test delivery note - Handle with care",
                            items: [
                                {
                                    item: "1210019",
                                    description: "",
                                    qty: 25,
                                    notes: ""
                                }
                            ]
                        }
                    ],
                    totalOrders: 1,
                    totalParts: 1,
                    totalQty: 25
                },
                {
                    stopNumber: 3,
                    customerName: "Maverick Power",
                    shipToName: "Maverick Power, LLC - Phoenix 2",
                    address: "1100 E Hammond Lane, Phoenix, AZ 85034",
                    boxCount: 0,
                    palletCount: 0,
                    orders: [
                        {
                            orderNumber: "1205066",
                            ticketNumber: "4584752",
                            poNumber: "PO-2024-06215",
                            deliveryNotes: "Test delivery note - Handle with care",
                            items: [
                                {
                                    item: "1778014",
                                    description: "",
                                    qty: 300,
                                    notes: ""
                                },
                                {
                                    item: "1825530",
                                    description: "",
                                    qty: 300,
                                    notes: ""
                                }
                            ]
                        },
                        {
                            orderNumber: "1205197",
                            ticketNumber: "4584771",
                            poNumber: "PO-2024-06215",
                            deliveryNotes: "",
                            items: [
                                {
                                    item: "3210062",
                                    description: "",
                                    qty: 4440,
                                    notes: ""
                                },
                                {
                                    item: "3210091",
                                    description: "",
                                    qty: 5000,
                                    notes: ""
                                },
                                {
                                    item: "3210127",
                                    description: "",
                                    qty: 3415,
                                    notes: ""
                                }
                            ]
                        }
                    ],
                    totalOrders: 2,
                    totalParts: 5,
                    totalQty: 13455
                }
            ]
        };

        window.addEventListener('DOMContentLoaded', function() {
            if (sessionStorage.getItem(SESSION_KEY) === 'true') {
                showRoute();
            }
        });

        function login() {
            const password = document.getElementById('password').value;
            const errorMsg = document.getElementById('error-message');

            if (password === CORRECT_PASSWORD) {
                sessionStorage.setItem(SESSION_KEY, 'true');
                showRoute();
            } else {
                errorMsg.textContent = 'Incorrect password. Please try again.';
                errorMsg.classList.add('show');
                document.getElementById('password').value = '';
                document.getElementById('password').focus();
            }
        }

        function showRoute() {
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('route-content').classList.add('show');
            document.getElementById('info-driver').textContent = routeData.driver;
            document.getElementById('info-stops').textContent = routeData.stops.length;
            document.getElementById('info-date').textContent = routeData.date;
            initializeRoute();
        }

        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('password');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        login();
                    }
                });
            }
        });

        function initializeRoute() {
            const container = document.getElementById('stops-container');
            container.innerHTML = '';
            routeData.stops.forEach((stop, index) => {
                const stopCard = createStopCard(stop, index);
                container.appendChild(stopCard);
            });
            updateCompleteButton();
        }

        function createStopCard(stop, index) {
            const card = document.createElement('div');
            card.className = 'stop-card';

            let orderDetailsHTML = '';
            stop.orders.forEach(order => {
                orderDetailsHTML += `
                    <div class="order-group">
                        <div class="order-header">
                            <strong>Order#</strong> ${order.orderNumber} | 
                            <strong>Ticket#</strong> ${order.ticketNumber}
                            ${order.poNumber ? ` | <strong>PO#</strong> ${order.poNumber}` : ''}
                        </div>
                `;

                if (order.deliveryNotes) {
                    orderDetailsHTML += `
                        <div class="delivery-notes">
                            <strong>Delivery Notes:</strong> ${order.deliveryNotes}
                        </div>
                    `;
                }

                orderDetailsHTML += `
                        <div class="order-items">
                `;

                order.items.forEach(item => {
                    orderDetailsHTML += `
                        <div class="item-row">
                            <span class="item-number">${item.item}</span>
                            ${item.description ? `<span class="item-desc"> - ${item.description}</span>` : ''}
                            <span class="item-qty">Qty: ${item.qty}</span>
                        </div>
                    `;
                    if (item.notes) {
                        orderDetailsHTML += `<div class="item-notes">Note: ${item.notes}</div>`;
                    }
                });

                orderDetailsHTML += `
                        </div>
                    </div>
                `;
            });

            card.innerHTML = `
                <div class="stop-header">
                    <div class="stop-number">${stop.stopNumber}</div>
                    <div class="customer-info">
                        <div class="customer-name">${stop.customerName}</div>
                        ${stop.shipToName && stop.shipToName !== stop.customerName ? 
                            `<div class="ship-to-name">${stop.shipToName}</div>` : ''}
                    </div>
                </div>

                <div class="stop-address">
                    ${stop.address}
                </div>

                <button class="btn-toggle-orders" id="toggle-${index}" onclick="toggleOrderDetails(${index})">
                    &#9654; Order Details (${stop.totalOrders} orders, ${stop.totalParts} items)
                </button>

                <div class="order-details-container" id="orders-${index}" style="display: none;">
                    ${orderDetailsHTML}

                    <div class="order-summary">
                        <strong>Total:</strong> ${stop.totalParts} Parts | ${stop.totalQty} Qty | 
                        ${stop.boxCount} Boxes | ${stop.palletCount} Pallets
                    </div>
                </div>

                <div class="review-status" id="review-status-${index}">
                    Please review order details before signing
                </div>

                <div class="signature-section" id="signature-section-${index}" style="display: none;">
                    <div class="signature-label">Reviewed - Customer Signature:</div>
                    <canvas class="signature-canvas" id="canvas-${index}"></canvas>
                    <div class="signature-buttons">
                        <button class="btn btn-clear" onclick="clearSignature(${index})">Clear</button>
                        <button class="btn btn-save" id="save-${index}" onclick="saveSignature(${index})">Save Signature</button>
                    </div>
                    <div class="signature-status" id="status-${index}"></div>
                    <img class="signature-thumbnail" id="thumbnail-${index}" />
                </div>
            `;

            return card;
        }

        const reviewedStops = {};

        function toggleOrderDetails(index) {
            const toggleBtn = document.getElementById(`toggle-${index}`);
            const ordersContainer = document.getElementById(`orders-${index}`);
            const reviewStatus = document.getElementById(`review-status-${index}`);
            const signatureSection = document.getElementById(`signature-section-${index}`);

            if (ordersContainer.style.display === 'none') {
                ordersContainer.style.display = 'block';
                toggleBtn.innerHTML = `&#9660; Order Details (${routeData.stops[index].totalOrders} orders, ${routeData.stops[index].totalParts} items)`;

                reviewedStops[index] = true;
                reviewStatus.style.display = 'none';
                signatureSection.style.display = 'block';

                setTimeout(() => initializeCanvas(index), 100);
            } else {
                ordersContainer.style.display = 'none';
                toggleBtn.innerHTML = `&#9654; Order Details (${routeData.stops[index].totalOrders} orders, ${routeData.stops[index].totalParts} items)`;
            }
        }

        const signatures = {};

        function initializeCanvas(index) {
            const canvas = document.getElementById(`canvas-${index}`);
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();

            canvas.width = rect.width * 2;
            canvas.height = rect.height * 2;
            ctx.scale(2, 2);

            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;

            function startDrawing(e) {
                isDrawing = true;
                const rect = canvas.getBoundingClientRect();
                const touch = e.touches ? e.touches[0] : e;
                lastX = touch.clientX - rect.left;
                lastY = touch.clientY - rect.top;
                signatures[index] = signatures[index] || { hasDrawn: false };
                signatures[index].hasDrawn = true;
            }

            function draw(e) {
                if (!isDrawing) return;
                e.preventDefault();

                const rect = canvas.getBoundingClientRect();
                const touch = e.touches ? e.touches[0] : e;
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;

                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(x, y);
                ctx.stroke();

                lastX = x;
                lastY = y;
            }

            function stopDrawing() {
                isDrawing = false;
            }

            canvas.addEventListener('touchstart', startDrawing);
            canvas.addEventListener('touchmove', draw);
            canvas.addEventListener('touchend', stopDrawing);

            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseleave', stopDrawing);
        }

        function clearSignature(index) {
            const canvas = document.getElementById(`canvas-${index}`);
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            signatures[index] = { hasDrawn: false, saved: false };

            const status = document.getElementById(`status-${index}`);
            status.classList.remove('saved');

            const thumbnail = document.getElementById(`thumbnail-${index}`);
            thumbnail.classList.remove('show');

            const saveBtn = document.getElementById(`save-${index}`);
            saveBtn.disabled = false;

            updateCompleteButton();
        }

        function saveSignature(index) {
            const canvas = document.getElementById(`canvas-${index}`);

            if (!signatures[index] || !signatures[index].hasDrawn) {
                alert('Please provide a signature first.');
                return;
            }

            const signatureData = canvas.toDataURL('image/png');
            signatures[index].data = signatureData;
            signatures[index].saved = true;
            signatures[index].timestamp = new Date().toISOString();

            const status = document.getElementById(`status-${index}`);
            status.textContent = 'Signature Saved';
            status.classList.add('saved');

            const thumbnail = document.getElementById(`thumbnail-${index}`);
            thumbnail.src = signatureData;
            thumbnail.classList.add('show');

            const saveBtn = document.getElementById(`save-${index}`);
            saveBtn.disabled = true;

            updateCompleteButton();
        }

        function updateCompleteButton() {
            const totalStops = routeData.stops.length;
            const signedStops = Object.values(signatures).filter(s => s.saved).length;

            const completeBtn = document.getElementById('btn-complete-route');
            completeBtn.textContent = `Complete Route (${signedStops}/${totalStops} stops signed)`;
            completeBtn.disabled = signedStops < totalStops;
        }

        function completeRoute() {
            const totalStops = routeData.stops.length;
            const signedStops = Object.values(signatures).filter(s => s.saved).length;

            if (signedStops < totalStops) {
                alert(`Please complete all signatures. ${totalStops - signedStops} stops remaining.`);
                return;
            }

            const completionData = {
                completedAt: new Date().toISOString(),
                driver: DRIVER_NAME,
                signatures: signatures
            };

            localStorage.setItem(DRIVER_NAME.toLowerCase() + '-route-completion', JSON.stringify(completionData));

            document.getElementById('completion-status').classList.add('show');
            document.getElementById('btn-complete-route').style.display = 'none';

            document.querySelectorAll('.signature-canvas').forEach(canvas => {
                canvas.style.pointerEvents = 'none';
                canvas.style.opacity = '0.6';
            });

            document.querySelectorAll('.signature-buttons').forEach(buttons => {
                buttons.style.display = 'none';
            });

            document.querySelectorAll('.btn-toggle-orders').forEach(btn => {
                btn.disabled = true;
            });
        }

        function exportSignatures() {
            const exportBtn = document.getElementById('btn-export-signatures');
            const exportStatus = document.getElementById('export-status');

            try {
                const exportData = {
                    manifestID: MANIFEST_ID,
                    driver: DRIVER_NAME,
                    exportDate: new Date().toISOString(),
                    routeDate: routeData.date,
                    totalStops: routeData.stops.length,
                    signatures: []
                };

                routeData.stops.forEach((stop, index) => {
                    const sig = signatures[index];
                    if (sig && sig.saved) {
                        exportData.signatures.push({
                            stopNumber: stop.stopNumber,
                            customerName: stop.customerName,
                            address: stop.address,
                            signatureData: sig.data,
                            timestamp: sig.timestamp,
                            orders: stop.orders.map(o => ({ orderNumber: o.orderNumber, ticketNumber: o.ticketNumber }))
                        });
                    }
                });

                const dateStr = new Date().toISOString().split('T')[0];
                const filename = `signatures_${DRIVER_NAME.replace(/\s+/g, '')}_${dateStr}_M${MANIFEST_ID}.json`;
                const jsonStr = JSON.stringify(exportData);

                const subject = encodeURIComponent(`Route Signatures - ${DRIVER_NAME} - ${dateStr}`);
                const body = encodeURIComponent(jsonStr);
                const mailtoLink = `mailto:iecsignaturecapture@gmail.com?subject=${subject}&body=${body}`;

                window.location.href = mailtoLink;

                exportStatus.className = 'export-status success';
                exportStatus.textContent = 'Email opened! Just tap Send to complete.';
                exportBtn.disabled = true;
                exportBtn.textContent = 'Email Opened';

            } catch (error) {
                exportStatus.className = 'export-status error';
                exportStatus.textContent = 'Error: ' + error.message;
            }
        }

    </script>
</body>
</html>
